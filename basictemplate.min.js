BasicTemplate=(function(){var p=1,C=2,A=3,v=4,z=5,i=6,f=7,h=0,j=1,g=2,r=0,k=1,y=3,o=4,c="{{",u="}}",d=new RegExp(/^\s+/),n=new RegExp(/if\s+([^=]+)/),s=new RegExp(/^[^=\s]+$/),x=new RegExp(/for\s+([a-zA-Z0-9_$]+)\s+in\s+([a-zA-Z0-9_$]+)$/),q={};function B(I,E){var D=I.length,H=E^D,G=0,F;while(D>=4){F=((I.charCodeAt(G)&255))|((I.charCodeAt(++G)&255)<<8)|((I.charCodeAt(++G)&255)<<16)|((I.charCodeAt(++G)&255)<<24);F=(((F&65535)*1540483477)+((((F>>>16)*1540483477)&65535)<<16));F^=F>>>24;F=(((F&65535)*1540483477)+((((F>>>16)*1540483477)&65535)<<16));H=(((H&65535)*1540483477)+((((H>>>16)*1540483477)&65535)<<16))^F;D-=4;++G}switch(D){case 3:H^=(I.charCodeAt(G+2)&255)<<16;case 2:H^=(I.charCodeAt(G+1)&255)<<8;case 1:H^=(I.charCodeAt(G)&255);H=(((H&65535)*1540483477)+((((H>>>16)*1540483477)&65535)<<16))}H^=H>>>13;H=(((H&65535)*1540483477)+((((H>>>16)*1540483477)&65535)<<16));H^=H>>>15;return H>>>0}function m(D){return(Object.prototype.toString.call(D)==="[object Array]")}function a(D){return(Object.prototype.toString.call(D)==="[object Function]")}function w(D){return D.replace(/^\s+/,"").replace(/\s+$/,"")}function b(D){this.tail=D;this.pos=0}b.prototype.scanUntil=function(F){var D=this.tail.search(F),E;if(D>=0){this.pos+=D;E=this.tail.substr(0,D);this.tail=this.tail.substr(D)}else{E=this.tail;this.pos+=this.tail.length;this.tail=""}return E};b.prototype.scan=function(D){var F=this.tail.match(D),E=null;if(F!==null){E=F[0].length;this.pos+=E;this.tail=this.tail.substr(E);return F[0]}return""};b.prototype.getPos=function(){return this.pos};b.prototype.end=function(){return(this.tail==="")};function t(D){this.data=D||{};this.cache={}}t.prototype.lookup=function(D){var F,G=null,E=0,H=0;if(D.indexOf(".")===-1){F=this.data[D]}else{if(D!=="."){if(D in this.cache){return this.cache[D]}F=this.data;G=D.split(".");for(E=0,H=G.length;E<H;E+=1){if(G[E] in F){F=F[G[E]]}else{F=""}}this.cache[D]=F}}if(F===undefined){if(this.parent){F=this.parent.lookup(D)}else{F=""}}if(a(F)){F=F.call(this.data)}return F};t.prototype.set=function(E,D){this.data[E]=D;this.cache={}};function e(D){this.text=D}e.prototype.buildTokens=function(){var E=0,K=0,O=0,M=[],F=null,S=this.text,P=null,G="{{",L="}}",Q=null,R=null,J=null,I=null,H=null,D=null,N=null;I=B(this.text);if(I in q){return q[I].slice(0)}while(E!==-1){P=S.substr(K);E=P.indexOf(G);if(E!==-1){N=P.substr(0,E);if(N!==""){M.push([p,O,N])}K+=E;P=P.substr(E);E=P.indexOf(L);if(E!==-1){Q=P.substr(2,E-2);K+=E+2;R=Q.charAt(0);switch(R){case"i":if(Q.charAt(1)==="f"&&Q.charAt(2)===" "){J=Q.match(n);if(J.length===2){F=[A,O++,w(J[1])];M.push(F);H=F}else{throw new Error('BasicTemplate.js: Invalid if token "'+S+'"')}}else{M.push([C,O,w(Q)])}break;case"f":if(Q.charAt(1)==="o"&&Q.charAt(2)==="r"&&Q.charAt(3)===" "){J=Q.match(x);if(J.length===3){M.push([i,O++,J[1],J[2]])}else{throw new Error('BasicTemplate.js: Invalid for token "'+S+'"')}}else{M.push([C,O,w(Q)])}break;case"e":if(Q==="else"){if(!H){throw new Error("BasicTemplate.js: Orphan else tag")}if(H[g][0]==="!"){D=H[g].substr(1)}else{D="!"+H[g]}M.push([v,--O,D]);O+=1}else{if(Q==="endif"){M.push([z,--O])}else{if(Q==="endfor"){M.push([f,--O])}else{M.push([C,O,w(Q)])}}}break;default:M.push([C,O,w(Q)])}}}else{if(P!==""){M.push([p,O,P])}}}if(O!==0){throw new Error("BasicTemplate.js: Unclosing tags on template")}q[I]=M.slice(0);return M};function l(E,D,F){this.templateString=E;this.model=D;this.tokens=F}l.prototype.compile=function(){var D=new t(this.model);if(!this.tokens){this.tokens=new e(this.templateString).buildTokens()}return this.compileTokens(this.tokens,D)};l.prototype.compileTokens=function(L,D){var F=null,G=[],K=null,N=[],H=o,M=null,E=null,I=L.length,J=0;while(L.length>0){F=L.shift();if(H===y){if(F[j]===K[j]){G.push(this.processGroupToken(N,D,K));H=o;N=[];K=null}else{N.push(F);continue}}M=F[h];if(M===A||M===v||M===i){H=y;K=F;continue}switch(F[h]){case p:G.push(F[g]);break;case C:G.push(D.lookup(F[g]));break}}return G.join("")};l.prototype.processGroupToken=function(G,D,E){var F="";switch(E[h]){case A:F=this.processIfGroup(G,D,E);break;case v:F=this.processIfGroup(G,D,E);break;case i:F=this.processForGroup(G,D,E);break}return F};l.prototype.processIfGroup=function(J,F,I){var G=I[g],E=(G[0]==="!")?G.substr(1):G,H=F.lookup(E),D="";if((H&&G[0]!=="!")||(!H&&G[0]==="!")){D=this.compileTokens(J,F)}return D};l.prototype.processForGroup=function(N,E,J){var G=new t({},E),F=E.lookup(J[g+1]),D=J[g],H=[],M=null,K=null,I=0,L=0;if(m(F)){for(I=0,L=F.length;I<L;I+=1){M=N.slice(0);K=F[I];G.set(D,K);H.push(this.compileTokens(M,G))}}return H.join("")};return{compile:function(E,D){var F=new l(E,D);return F.compile()},compileWithTokens:function(E,D){var F=new l(null,D,E);return F.compile()},tokenize:function(D){return new e(D).buildTokens()},clearCache:function(){q={}},Context:t}}());